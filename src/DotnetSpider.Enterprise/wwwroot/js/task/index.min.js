$(function(){function t(n){var i=n.$data.keyword||"",r={page:n.$data.page,size:n.size,keyword:i};dsApp.post("/Task/Query",r,function(i){var r=i.result.result;$(r).each(function(){this.running=!1});n.$data.tasks=r;n.$data.total=i.result.total;dsApp.ui.initPagination("#pagination",i.result,function(i){n.$data.page=i;t(n)})})}setMenuActive("task");var i,r={id:0,name:"",version:"",os:"All",applicationName:"dotnet",isEnabled:!0,cron:"",nodeCount:1,arguments:"",owners:"",developers:"",analysts:"",tags:"",nodeType:1,isSingle:!0},n=new Vue({el:"#tasksView",data:{tasks:[],total:0,size:50,keyword:"",page:1,newTask:$.extend({},r),isView:!1,errorText:{name:"",applicationName:"",version:"",arguments:""}},mounted:function(){this.$data.page=1;t(this)},computed:{buttonState:function(){return this.nameVdt&&this.validateEmpty&&this.versionVdt&&this.argumentsVdt&&this.applicationNameVdt&&this.cronVdt&this.nodeCountVdt},nameVdt:function(){return this.validateEmpty(this,"name",!0)},nodeCountVdt:function(){if(this.validateEmpty(this,"nodeCount",!0)){var n=this.newTask.nodeCount;return n>=1&&n<100}return!1},versionVdt:function(){return this.validateEmpty(this,"version",!0)},argumentsVdt:function(){var n=this.newTask.arguments;return n&&(n.indexOf("-tid:")>=0||n.indexOf("-i:")>=0)?(this.errorText.arguments="Arguments should not contains -tid or -i",!1):(delete this.errorText.arguments,!0)},applicationNameVdt:function(){var n=this.newTask.applicationName;return this.validateEmpty(this,"applicationName",!1)?n.length>100?(this.errorText.applicationName="Less than 100 characters.",!1):(delete this.errorText.applicationName,!0):!1},cronVdt:function(){return this.validateEmpty(this,"cron",!0)}},methods:{onTriggerClick:function(){var n=$("#SchedulerModal");i=$("#cron1").msCron();cronId=null;n.modal("show")},validateEmpty:function(n,t,i){var r=this.newTask[t];return r===""?(n.errorText[t]="",null):$.trim(r)===""?(n.errorText[t]="Value can not be empty.",!1):(i&&delete n.errorText[t],!0)},leave:function(n){validator[n.target.name]&&!validator[n.target.name](n.target,this.newTask[n.target.name])},query:function(){n.$data.keyword=$("#queryKeyword").val();t(n)},onKeyPress:function(t){t.charCode===13&&(n.$data.page=1,this.query())},saveSpider:function(){if(!(Object.getOwnPropertyNames(this.errorText).length>1)){var i=this.newTask;i.id>0?dsApp.post("/task/modify",i,function(){$("#CreateNewTaskModal").modal("hide");t(n)}):dsApp.post("/task/add",i,function(){$("#CreateNewTaskModal").modal("hide");t(n)})}},run:function(n){var i=this;dsApp.post("/task/run",{taskId:n.id},function(){swal("Operation Succeed!","Task is prepare to run.","success");t(i)})},remove:function(n){var i=this;swal({title:"Are you sure?",text:"Remove this task!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, do it!",closeOnConfirm:!1},function(){dsApp.post("/task/remove",{taskId:n.id},function(){swal("Operation Succeed!","Task was removed.","success");t(i)})})},exit:function(n){var i=this;dsApp.post("/task/exit",{taskId:n},function(){swal("Operation Succeed!","Task would be exited.","success");t(i)})},add:function(){var t=$("#CreateNewTaskModal");n.$data.isView=!1;n.$data.newTask=$.extend({},r);t.modal("show")},view:function(t){var u=$("#CreateNewTaskModal"),r,i;n.$data.isView=!0;r={};for(i in t)t.hasOwnProperty(i)&&(r[i]=t[i]);n.$data.newTask=r;u.modal("show")},modify:function(t){var u=$("#CreateNewTaskModal"),r={};for(var i in t)t.hasOwnProperty(i)&&(r[i]=t[i]);n.$data.newTask=r;u.modal("show")},disable:function(n){var i=this;swal({title:"Are you sure?",text:"Disable this task!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, do it!",closeOnConfirm:!1},function(){dsApp.post("/task/disable",{taskId:n.id},function(){swal("Operation Succeed!","Task was disabled.","success");t(i)})})},enable:function(n){var i=this;dsApp.post("/task/enable",{taskId:n.id},function(){swal("Operation Succeed!","Task was enabled.","success");t(i)})}}});$("#saveTrigger").bind("click",function(){var t=i.getCron(),r=$("#SchedulerModal");r.modal("hide");n.$data.newTask.cron=t.cron})});