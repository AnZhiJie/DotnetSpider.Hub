$(function(){function n(t){var i=t.$data.keyword||"",r={page:t.$data.page,size:t.size,keyword:i};dsApp.post("/Task/Query",r,function(i){var r=i.result.result;$(r).each(function(){this.running=!1});t.$data.tasks=r;t.$data.total=i.result.total;dsApp.ui.initPagination("#pagination",i.result,function(i){t.$data.page=i;n(t)})})}setMenuActive("task");var i,r={id:0,name:"",version:"",os:"All",applicationName:"dotnet",isEnabled:!0,cron:"",nodeCount:1,arguments:"",owners:"",developers:"",analysts:"",tags:""},t=new Vue({el:"#tasksView",data:{tasks:[],total:0,size:10,keyword:"",page:1,newTask:$.extend({},r),errorText:{name:"",applicationName:"",version:"",arguments:""}},mounted:function(){this.$data.page=1;n(this)},computed:{buttonState:function(){return this.nameVdt&&this.validateEmpty&&this.versionVdt&&this.argumentsVdt&&this.applicationNameVdt&&this.cronVdt},nameVdt:function(){return this.validateEmpty(this,"name",!0)},versionVdt:function(){return this.validateEmpty(this,"version",!0)},argumentsVdt:function(){var n=this.newTask.arguments;return this.validateEmpty(this,"arguments",!1)?n.indexOf("-tid:")>=0||n.indexOf("-i:")>=0?(this.errorText.arguments="Arguments can not be -tid or -i",!1):(delete this.errorText.arguments,!0):!1},applicationNameVdt:function(){var n=this.newTask.applicationName;return this.validateEmpty(this,"applicationName",!1)?n.length>100?(this.errorText.applicationName="Less than 100 characters.",!1):(delete this.errorText.applicationName,!0):!1},cronVdt:function(){return this.validateEmpty(this,"cron",!0)}},methods:{onTriggerClick:function(){var n=$("#SchedulerModal");i=$("#cron1").msCron();cronId=null;n.modal("show")},validateEmpty:function(n,t,i){var r=this.newTask[t];return r===""?(n.errorText[t]="",null):$.trim(r)===""?(n.errorText[t]="Value can not be empty.",!1):(i&&delete n.errorText[t],!0)},leave:function(n){validator[n.target.name]&&!validator[n.target.name](n.target,this.newTask[n.target.name])},query:function(){t.$data.page=1;t.$data.keyword=$("#queryKeyword").val();n(t)},onKeyPress:function(n){n.charCode===13&&this.query()},saveSpider:function(){if(!(Object.getOwnPropertyNames(this.errorText).length>1)){var i=this.newTask;i.id>0?dsApp.post("/task/modify",i,function(){$("#CreateNewTaskModal").modal("hide")}):dsApp.post("/task/add",i,function(){$("#CreateNewTaskModal").modal("hide");n(t)})}},run:function(t){var i=this;dsApp.post("/task/run",{taskId:t.id},function(){swal("Operation Succeed!","Task is prepare to run.","success");n(i)})},remove:function(t){var i=this;swal({title:"Are you sure?",text:"Remove this task!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, do it!",closeOnConfirm:!1},function(){dsApp.post("/task/remove",{taskId:t.id},function(){swal("Operation Succeed!","Task was removed.","success");n(i)})})},exit:function(t){var i=this;dsApp.post("/task/exit",{taskId:t},function(){swal("Operation Succeed!","Task would be exited.","success");n(i)})},add:function(){var n=$("#CreateNewTaskModal");t.$data.newTask=$.extend({},r);n.modal("show")},modify:function(n){var i=$("#CreateNewTaskModal");t.$data.newTask=n;i.modal("show")},disable:function(t){var i=this;swal({title:"Are you sure?",text:"Disable this task!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, do it!",closeOnConfirm:!1},function(){dsApp.post("/task/disable",{taskId:t.id},function(){swal("Operation Succeed!","Task was disabled.","success");n(i)})})},enable:function(t){var i=this;dsApp.post("/task/enable",{taskId:t.id},function(){swal("Operation Succeed!","Task was enabled.","success");n(i)})}}});$("#saveTrigger").bind("click",function(){var n=i.getCron(),r=$("#SchedulerModal");r.modal("hide");t.$data.newTask.cron=n.cron})});