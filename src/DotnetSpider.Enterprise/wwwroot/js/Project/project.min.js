$(function(){function r(n,t,i){var r=t.parent();r.addClass("error");$("#"+n+"-error").length?$("#"+n+"-error").text(i):r.parent().append('<label id="'+n+'-error" class="error" for="email">'+i+"<\/label>")}function f(n,t){t.parent().removeClass("error");$("#"+n+"-error").remove()}function o(n){$("#LogsModal").modal("show");i.$data.status.buildId=n;e()}function e(){dsApp.post("/project/GetStatusAndLogs",{buildId:i.$data.status.buildId},function(n){(i.$data.status=n.result,n.result.status!="Finished"&&n.result.status!="Exception")&&setTimeout(e,5e3)})}function u(){dsApp.get("/project/list",function(n){i.$data.projects=n.result||[]})}var t={gitUrl:{blur:function(n,t){if($.trim(t)=="")return r("gitUrl",n,"git url can not be empty."),!1;var i=new RegExp("((http|ftp|https)://)(([a-zA-Z0-9\\._-]+\\.?[a-zA-Z]{0,6})|([0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}))(:[0-9]{1,4})*(/[a-zA-Z0-9\\&%_\\./-~-,\\*#]*)?(\\?[a-zA-Z0-9\\&%_\\./-~-\\*,#]*)?","gi");return i.test(t)?(f("gitUrl",n),!0):(r("gitUrl",n,"It is not a valid git url."),!1)}},entryProject:{blur:function(n,t){return $.trim(t)==""?(r("entryProject",n,"entry project can not be empty."),!1):(f("entryProject",n),!0)}}},n=null,i=new Vue({el:"#container",data:{projects:[],current:{name:"",gitUrl:"",intervalPath:"",framework:"Net45",entryProject:"",isEnabled:!0},onEdit:!1,status:{buildId:0,logs:[],status:"Waitting",filePath:""}},mounted:function(){u()},methods:{clone:function(n,t){n.id=t.id;n.name=t.name;n.gitUrl=t.gitUrl;n.intervalPath=t.intervalPath;n.framework=t.framework;n.isEnabled=t.isEnabled;n.entryProject=t.entryProject},addProject:function(){n=null;this.onEdit=!1;$("#NewRoleModal").modal("show");this.clone(this.current,{name:"",gitUrl:"",intervalPath:"",entryProject:"",framework:"Net45",isEnabled:!0})},editProject:function(t){n=t;this.onEdit=!0;$("#NewRoleModal").modal("show");this.clone(this.current,t)},saveProject:function(){var r,i;t.gitUrl.blur($("#gitUrl"),this.current.gitUrl)&&t.entryProject.blur($("#entryProject"),this.current.entryProject)&&(r=this,n?(i=JSON.parse(JSON.stringify(n)),this.clone(i,this.current),dsApp.post("/project/modifyProject",i,function(){r.clone(n,i);$("#NewRoleModal").modal("hide")})):dsApp.post("/project/addProject",this.current,function(n){r.projects.splice(0,0,n.result);$("#NewRoleModal").modal("hide")}))},publishProject:function(n){if(!n.isEnabled){swal("Sorry!","Project was disabled.","error");return}var t=this;swal({title:"Input",text:"Version description(tags):",type:"input",showCancelButton:!0,closeOnConfirm:!1,animation:"slide-from-top",inputPlaceholder:"Version or tips..."},function(t){if(swal.close(),t===!1)return!1;dsApp.post("/project/PublishProject",{projectId:n.id,tags:t},function(n){o(n.result)})})},removeProject:function(n){var t=this;swal({title:"Are you sure?",text:"You will not be able to recover this project!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!1},function(){dsApp.post("/project/RemoveProject",{projectId:n.id},function(){swal.close();var i=t.projects.indexOf(n);t.projects.splice(i,1)})})},leaveGitUrl:function(n){var u=this.current.gitUrl,i,r;t.gitUrl.blur($(n.target),u)&&(i=u.split("/"),r=i[i.length-1].split("."),r.pop(),this.current.name=r.join("."),$("#name").parent().addClass("focused"))},leaveEntryProject:function(n){var i=this.current.entryProject;!t.entryProject.blur($(n.target),i)},disableProject:function(n){swal({title:"Are you sure?",text:"To disable this project!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, disable it!",closeOnConfirm:!1},function(){dsApp.post("/project/enableOrDisableProject",{projectId:n.id,enabled:!1},function(){swal("Disabled!","Project disabled.","success");u()})})},enableProject:function(n){dsApp.post("/project/enableOrDisableProject",{projectId:n.id,enabled:!0},function(){swal("Enabled!","Project enabled.","success");u()})}}});setTimeout(function(){$(".menu li").removeClass("active");$(".menu li a").removeClass("toggled");$(".menu li#projects").addClass("active");$(".menu li#projects a").addClass("toggled")},50)});